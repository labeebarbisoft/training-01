{% extends "rentals/base.html" %}
{% load static %}
{% load mathfilters %}


{% block extra_css %}
    <link rel="stylesheet" type="text/css" href="{% static 'messages.css' %}">
{% endblock %}


{% block content %}
{% if notifications %}
<table class="table table-bordered">
    <thead>
      <tr>
        <th scope="col">Messages</th>
      </tr>
    </thead>
    <tbody>
      {% for message in notifications %}
      <tr class="
          {% if message.notification_status != 'read' %}
          table-primary
          {% else %}
          table-secondary
          {% endif %}">
          <td>{{ message }}
          {% if message.booking_status == "completed" %}
            {% if message.booking_request.reviewed == False %}
              <form method="post" action="/submit_rating">
                {% csrf_token %}
                <input type="hidden" name="booking_request_id" value="{{ message.booking_request.id }}">
                <div class="rating">
                  <input type="number" name="rating" hidden>
                  <i class='bx bx-star star' style="--i: 0;"></i>
                  <i class='bx bx-star star' style="--i: 1;"></i>
                  <i class='bx bx-star star' style="--i: 2;"></i>
                  <i class='bx bx-star star' style="--i: 3;"></i>
                  <i class='bx bx-star star' style="--i: 4;"></i>
                </div>
                  <input type="submit" class="btn btn-primary" value="Submit">
                </div>
              </form>
          </td>
            {% else %}
              <div class="rating">
                {% with ''|center:message.booking_request.rating as range %}
                  {% for _ in range %}
                    <i class='bx active bxs-star' style="--i: 1;"></i>
                  {% endfor %}
                  {% endwith %}
                  {% with 5|sub:message.booking_request.rating as difference %}
                  {% with ''|center:difference as range %}
                  {% for _ in range %}
                    <i class='bx bx-star star' style="--i: 1;"></i>
                  {% endfor %}
                  {% endwith %}
                  {% endwith %}
              </div>
          </td>
            {% endif %}
          {% elif message.booking_request.status == "approved" %}
              <form method="post" action="/mark_complete">
                  {% csrf_token %}
                  <input type="hidden" name="booking_request_id" value="{{ message.booking_request.id }}">
                  <input type="submit" class="btn btn-primary" value="Mark as complete">
              </form>
          </td>
          {% endif %}
      </tr>
      {% endfor %}
  </tbody>
</table>
{% else %}
<h1>No notifications yet!</h1>
{% endif %}
{% endblock %}


{% block extra_js %}
    <script src="{% static 'messages.js' %}"></script>
{% endblock %}